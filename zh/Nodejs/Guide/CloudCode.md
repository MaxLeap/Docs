# äº‘ä»£ç 

##### _Author: Marvin
##### _Github: https://github.com/zhoucen

## ç®€ä»‹
### ä»€ä¹ˆæ˜¯äº‘ä»£ç æœåŠ¡
äº‘ä»£ç æ˜¯éƒ¨ç½²è¿è¡Œåœ¨ MaxLeap äº‘å¼•æ“ä¸Šçš„ä»£ç ï¼Œæ‚¨å¯ä»¥ç”¨å®ƒæ¥å®ç°è¾ƒå¤æ‚çš„ï¼Œéœ€è¦è¿è¡Œåœ¨äº‘ç«¯çš„ä¸šåŠ¡é€»è¾‘ã€‚å®ƒç±»ä¼¼äºä¼ ç»Ÿçš„è¿è¡Œåœ¨ Web serverä¸Šçš„ Web Serviceæˆ– RESTful APIã€‚å®ƒå¯¹å¤–æä¾›çš„æ¥å£ä¹Ÿæ˜¯ RESTful APIï¼Œä¹Ÿæ­£æ˜¯ä»¥è¿™ç§æ–¹å¼è¢«ç§»åŠ¨åº”ç”¨è°ƒç”¨ã€‚ 

### ä¸ºä»€ä¹ˆéœ€è¦äº‘ä»£ç æœåŠ¡

å¦‚æœåº”ç”¨éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘éƒ½æ”¾åœ¨å®¢æˆ·ç«¯é‡Œé¢å®ç°ã€‚ç„¶è€Œï¼Œå½“åº”ç”¨éœ€è¦å®ç°æ¯”è¾ƒå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œè®¿é—®æ›´å¤šçš„æ•°æ®æˆ–éœ€è¦å¤§é‡çš„è¿ç®—æ—¶ï¼Œæˆ‘ä»¬ä¾¿éœ€è¦å€ŸåŠ©äº‘ä»£ç æœåŠ¡å®ç°ï¼Œå…¶ä¼˜åŠ¿åœ¨äºï¼š

* å¼ºå¤§çš„è¿ç®—èƒ½åŠ›ï¼šäº‘ä»£ç è¿è¡Œåœ¨ MaxLeap çš„ Docker å®¹å™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªCPUå’Œå¤§å®¹é‡å†…å­˜è¿›è¡Œè®¡ç®—
* æ›´é«˜æ•ˆï¼šå¯ä»¥åœ¨ä¸€æ¬¡è°ƒç”¨ä¸­é€šè¿‡é«˜é€Ÿç½‘ç»œå¤šæ¬¡è¯·æ±‚ Cloud Dataï¼Œå¤§å¤§æå‡æ•ˆç‡
* åŒä¸€å¥—ä»£ç å¯ä»¥ä¸º iOSï¼ŒAndroidï¼ŒWeb Site ç­‰æä¾›æœåŠ¡


## å¯¹è±¡
å­˜å‚¨åœ¨äº‘æ•°æ®çš„å¯¹è±¡ç§°ä¸º `ML.Object`ï¼Œè€Œæ¯ä¸ª `ML.Object` è¢«è§„åˆ’è‡³ä¸åŒçš„ `class` ä¸­ï¼ˆç±»ä¼¼â€œè¡¨â€çš„æ¦‚å¿µ)ã€‚`ML.Object` åŒ…å«è‹¥å¹²é”®å€¼å¯¹ï¼Œä¸”å€¼ä¸ºå…¼å®¹ JSON æ ¼å¼çš„æ•°æ®ã€‚è€ƒè™‘åˆ°æ•°æ®å®‰å…¨ï¼ŒMaxLeap ç¦æ­¢å®¢æˆ·ç«¯ä¿®æ”¹æ•°æ®ä»“åº“çš„ç»“æ„ã€‚æ‚¨éœ€è¦é¢„å…ˆåœ¨ MaxLeap å¼€å‘è€…å¹³å°ä¸Šåˆ›å»ºéœ€è¦ç”¨åˆ°çš„è¡¨ï¼Œç„¶åä»”ç»†å®šä¹‰æ¯ä¸ªè¡¨ä¸­çš„å­—æ®µå’Œå…¶å€¼ç±»å‹ã€‚

### æ–°å»º
å‡è®¾æˆ‘ä»¬è¦ä¿å­˜ä¸€æ¡æ•°æ®åˆ° `Comment` classï¼Œå®ƒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š

å±æ€§å|å€¼|å€¼ç±»å‹
-------|-------|---|
content|"æˆ‘å¾ˆå–œæ¬¢è¿™æ¡åˆ†äº«"|å­—ç¬¦
pubUserId|1314520|æ•°å­—
isRead|false|å¸ƒå°”

æˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨é©¼å³°å¼å‘½åæ³•æ¥å‘½åç±»åå’Œå­—æ®µåï¼ˆå¦‚ï¼šNameYourclassesLikeThis, nameYourKeysLikeThisï¼‰ï¼Œè®©æ‚¨çš„ä»£ç çœ‹èµ·æ¥æ•´é½ç¾è§‚ã€‚

```javascript
var Comment = ML.Object.extend('Comment');
var comment = new Comment();
comment.set('content', 'æˆ‘å¾ˆå–œæ¬¢è¿™æ¡åˆ†äº«');
comment.set('pubUserId', 1314520);
comment.set('isRead', false);

comment.save();
```
è¯¥ä»£ç è¿è¡Œåï¼Œæ‚¨å¯èƒ½æƒ³çŸ¥é“æ˜¯å¦çœŸçš„æ‰§è¡Œäº†ç›¸å…³æ“ä½œã€‚ä¸ºç¡®ä¿æ•°æ®æ­£ç¡®ä¿å­˜ï¼Œæ‚¨å¯ä»¥åœ¨ MaxLeap å¼€å‘ä¸­å¿ƒæŸ¥çœ‹åº”ç”¨ä¸­çš„æ•°æ®ã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹çš„å†…å®¹ï¼š

```
objectId: "563c154ca5ff7f000168964b", content: "æˆ‘å¾ˆå–œæ¬¢è¿™æ¡åˆ†äº«", pubUserId: 1314520, isRead: false,
createdAt:"2015-11-06T02:49:48.235Z", updatedAt:"2015-11-06T02:49:48.235Z"
```

æ³¨æ„ï¼š

* **Commentè¡¨åˆä½•æ—¶åˆ›å»º:** å‡ºäºæ•°æ®å®‰å…¨è€ƒè™‘ï¼ŒMaxLeap ç¦æ­¢å®¢æˆ·ç«¯åˆ›å»ºè¡¨ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å‰å¿…é¡»å…ˆç™»å½• MaxLeap çš„æ§åˆ¶å°å¹¶æ‰‹åŠ¨åˆ›å»º Comment è¡¨ã€‚è¿™æ ·åœ¨è¿è¡Œä»£ç åè¿™æ¡æ•°æ®æ‰ä¼šè¢«æˆåŠŸæ’å…¥ã€‚
* **è¡¨ä¸­åŒä¸€å±æ€§å€¼ç±»å‹ä¸€è‡´:** å¦‚æœäº‘ç«¯çš„è¿™ä¸ªåº”ç”¨ä¸­å·²ç»å­˜åœ¨åä¸º Comment çš„æ•°æ®è¡¨ï¼Œè€Œä¸”ä¹ŸåŒ…æ‹¬ `content`ã€`pubUserId`ã€`isRead` ç­‰å±æ€§ï¼Œé‚£ä¹ˆï¼Œæ–°å»º comment å¯¹è±¡æ—¶ï¼Œå¯¹åº”å±æ€§çš„å€¼çš„æ•°æ®ç±»å‹è¦å’Œåˆ›å»ºè¯¥å±æ€§æ—¶ä¸€è‡´ï¼Œå¦åˆ™ä¿å­˜æ•°æ®å°†å¤±è´¥ã€‚
* **`ML.Object`æ˜¯Schemalessçš„:** æ‚¨æ— éœ€äº‹å…ˆæŒ‡å®š `ML.Object` å­˜åœ¨å“ªäº›é”®ï¼Œåªéœ€åœ¨éœ€è¦çš„æ—¶å€™å¢åŠ é”®å€¼å¯¹ï¼Œåå°ä¾¿ä¼šè‡ªåŠ¨å‚¨å­˜å®ƒä»¬ã€‚
* **å†…å»ºçš„å±æ€§:** æ¯ä¸ª `ML.Object` å¯¹è±¡æœ‰ä»¥ä¸‹å‡ ä¸ªä¿å­˜å…ƒæ•°æ®çš„å±æ€§æ˜¯ä¸éœ€è¦å¼€å‘è€…æŒ‡å®šçš„ã€‚è¿™äº›å±æ€§çš„åˆ›å»ºå’Œæ›´æ–°æ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„ï¼Œè¯·ä¸è¦åœ¨ä»£ç é‡Œä½¿ç”¨è¿™äº›å±æ€§æ¥ä¿å­˜æ•°æ®ã€‚

	å±æ€§å|å€¼|
	-------|-------|
	objectId|å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦
	createdAt|å¯¹è±¡çš„åˆ›å»ºæ—¶é—´
	updatedAt|å¯¹è±¡çš„æœ€åä¿®æ”¹æ—¶é—´

* **å¤§å°é™åˆ¶ï¼š** `ML.Object` çš„å¤§å°è¢«é™åˆ¶åœ¨128Kä»¥å†…ã€‚
* é”®çš„åç§°å¯ä»¥åŒ…å«è‹±æ–‡å­—æ¯ï¼Œæ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œä½†æ˜¯å¿…é¡»ä»¥å­—æ¯å¼€å¤´ã€‚å€¼çš„ç±»å‹å¯ä¸ºå­—ç¬¦, æ•°å­—, å¸ƒå°”, æ•°ç»„æˆ–æ˜¯ `ML.Object`ï¼Œä¸ºæ”¯æŒ JSON ç¼–ç çš„ç±»å‹å³å¯.
* æ‚¨å¯ä»¥åœ¨è°ƒç”¨ `comment.save()`æ—¶ï¼Œé“¾å¼è°ƒç”¨ `.then()`ï¼Œç”¨ä»¥æ£€æŸ¥æ–°å»ºæ˜¯å¦æˆåŠŸã€‚

```javascript
comment.save().then(function(){
  console.log('success');
}, function(){
  console.log('fail');
});
```
### æ£€ç´¢
##### è·å– `ML.Object `
æ‚¨å¯ä»¥é€šè¿‡æŸæ¡æ•°æ®çš„ `ObjectId`ï¼Œç”¨ `ML.Query` è·å–å®Œæ•´çš„ `ML.Object`ï¼š

```javascript
var query = new ML.Query(Comment);
query.get('563c154ca5ff7f000168964b').then(function(comment){
  console.log(comment);
});
```
##### è·å– `ML.Object` å±æ€§å€¼
ä¸ºäº†è·å¾— `ML.Object` çš„å±æ€§å€¼ï¼Œåº”è¯¥ä½¿ç”¨ `get()` æ–¹æ³•ï¼š

```javascript
var content = comment.get('content');
```

### æ›´æ–°
æ›´æ–° `ML.Object` éœ€è¦ä¸¤æ­¥ï¼šé¦–å…ˆè·å–éœ€è¦æ›´æ–°çš„ `ML.Object`ï¼Œç„¶åä¿®æ”¹å¹¶ä¿å­˜ï¼š

```javascript
var query = new ML.Query(Comment);
query.get('563c154ca5ff7f000168964b').then(function(comment){
  comment.set('isRead', true);
  
  comment.save().then(function(comment){
    console.log(comment);
  }, function(error){
    console.log(error);
  });
});
```

### åˆ é™¤
##### åˆ é™¤ `ML.Object`
è°ƒç”¨å¦‚ä¸‹ä»£ç ä¼šåœ¨ MaxLeap ä¸­åˆ é™¤ä¸€ä¸ªå®ä¾‹ï¼š

```javascript
comment.destroy().then(function(result){
//success
}, function(){
//error
});
```

##### æ‰¹é‡åˆ é™¤
æ‰¹é‡åˆ é™¤ä¸€æ‰¹å¯¹è±¡å¯ä»¥è¿™æ ·ï¼š

```javascript
ML.Object.destroyAll(objects);
```

å…¶ä¸­ `objects` æ˜¯ä¸€ä¸ªå¯¹è±¡é›†åˆï¼Œä¸”å…¶ä¸­çš„æ¯ä¸ªå¯¹è±¡çš„ `className` å¿…é¡»ä¸€æ ·ã€‚

##### åˆ é™¤ `ML.Object` å±æ€§å€¼
æ‚¨å¯ä»¥ä½¿ç”¨ `unset` æ–¹æ³•æ¥åˆ é™¤ä¸€ä¸ªå®ä¾‹ä¸­çš„å•ä¸ªå±æ€§ï¼š

```javascript
comment.unset('content');
comment.save();
```

### å…³è”æ•°æ®
å¯¹è±¡å¯èƒ½ä¸åˆ«çš„å¯¹è±¡æœ‰å…³ç³»ã€‚æ¯”å¦‚å¯¹äºå¾®åšæ¥è¯´ï¼Œä¸€æ¡å¾®åšä¿¡æ¯(Post å¯¹è±¡)å¯èƒ½æœ‰å¾ˆ å¤šè¯„è®º(Comment å¯¹è±¡)ã€‚MaxLeap æ”¯æŒå„ç§å…³ç³»ï¼ŒåŒ…æ‹¬ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šã€‚

##### ä¸€å¯¹ä¸€å…³è”
ä¸€å¯¹ä¸€å…³ç³»å’Œä¸€å¯¹å¤šå…³ç³»éƒ½å¯ä»¥é€šè¿‡åœ¨ä¸€ä¸ª ML.Object å†…ä¿å­˜å¦ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹æ¥å®ç°ã€‚ æ¯”å¦‚ï¼Œæ¯ä¸€ä¸ª Comment éƒ½å¯¹åº”äº†ä¸€ä¸ª Postï¼Œåˆ›å»ºä¸€ä¸ªå¸¦ä¸€æ¡ Comment çš„ Post, ä½ å¯ä»¥è¿™æ ·å†™ï¼š

```javascript
var post = new Post();
var comment = new Comment();
post.set('content', 'è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€æ¡å¾®åšä¿¡æ¯ï¼Œè¯·å¤§å®¶å¤šå¤šå…³ç…§ã€‚');
comment.set('content', 'æœŸå¾…æ‚¨æ›´å¤šçš„å¾®åšä¿¡æ¯ã€‚');
comment.add('post', post);
comment.save()
```
MaxLeap å†…éƒ¨ä¼šè‡ªåŠ¨å¤„ç†ï¼Œè°ƒç”¨ Comment çš„ save æ–¹æ³•å°±å¯ä»¥åŒæ—¶ä¿å­˜ä¸¤ä¸ªæ–°å¯¹è±¡ã€‚

å¦‚æœæ˜¯ç°æœ‰å¯¹è±¡æƒ³è¦å…³è”åˆ°æ–°å¯¹è±¡ï¼Œä½ åŒæ ·å¯ä»¥é€šè¿‡åªç”¨å®ƒä»¬çš„ `objectId` æ¥è¿æ¥å½¼æ­¤ã€‚ è¯·æ³¨æ„ï¼Œä¸èƒ½ç›´æ¥åƒä¸Šé¢çš„ä¾‹å­é‚£æ ·å°†ç°æœ‰å¯¹è±¡è®¾ç½®è¿›å»ï¼Œè€Œæ˜¯å¿…é¡» new ä¸€ä¸ªæ–°å¯¹è±¡å¹¶åªè®¾ç½® `objectId` å±æ€§ï¼š

```javascript
var post = ML.Object.createWithoutData('Post', '5652ae2ba5ff7f00011d1c0b');
var comment = new Comment();
comment.add('post', post);
comment.save();
```
æˆ–è€…ï¼š

```javascript
var post = new Post();
post.id = '5652ae2ba5ff7f00011d1c0b';
var comment = new Comment();
comment.add('post', post);
comment.save();
```
##### ä¸€å¯¹å¤šå…³è”
æŠŠä¸¤æ¡è¯„è®ºå…³è”è‡³ä¸€æ¡å¾®åšä¸­ï¼š

```javascript
var post = new Post();
post.set('content', 'è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€æ¡å¾®åšä¿¡æ¯ï¼Œè¯·å¤§å®¶å¤šå¤šå…³ç…§ã€‚');

var comment1 = new Comment();
comment1.set('content', 'æœŸå¾…æ‚¨æ›´å¤šçš„å¾®åšä¿¡æ¯ã€‚');
var comment2 = new Comment();
comment2.set('content', 'æˆ‘ä¹ŸæœŸå¾…ã€‚');

post.add('comment', comment1);
post.add('comment', comment2);
post.save()
```

##### å¤šå¯¹å¤šå…³è”
å¤šå¯¹å¤šå…³ç³»æ˜¯é€šè¿‡ `ML.Relation` æ¥å»ºæ¨¡çš„ã€‚è¿™æ ·å¾ˆåƒåœ¨ä¸€ä¸ª key ä¸­å­˜å‚¨ä¸€ä¸ª `ML.Object` æ•°ç»„ã€‚ä½†æ˜¯åŒºåˆ«ä¹‹å¤„åœ¨äºï¼Œåœ¨è·å–é™„åŠ å±æ€§çš„æ—¶å€™ï¼Œ`ML.Relation` ä¸éœ€è¦åŒæ­¥è·å–å…³è”çš„æ‰€æœ‰ `ML.Object` å®ä¾‹ã€‚è¿™ä½¿å¾— `ML.Relation` æ¯”æ•°ç»„çš„æ–¹å¼å¯ä»¥æ”¯æŒæ›´å¤šå®ä¾‹ï¼Œè¯»å–æ–¹å¼ä¹Ÿæ›´åŠ çµæ´»ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª User å¯ä»¥å–œæ¬¢å¾ˆå¤š Postã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥ç”¨ `relation()` æ–¹æ³•ä¿å­˜ä¸€ä¸ªç”¨æˆ·å–œæ¬¢çš„æ‰€æœ‰ Post é›†åˆã€‚ä¸ºäº†æ–°å¢ä¸€ä¸ªå–œæ¬¢çš„ Postï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š

```javascript
var relation = user.relation('likes');
relation.add(post);
user.save()
```
ä»…å¯ä»¥ä»ä¸€ä¸ª `ML.Relation` ä¸­åˆ é™¤ä¸€ä¸ª post:
```javascript
relation.remove(post);
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`relation` å…³è”çš„å¯¹è±¡ä¸å›è¢«åŒæ­¥è·å–åˆ°ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ `query` æ–¹æ³•è¿”å›çš„ `ML.Query` å¯¹è±¡æ¥è·å– `ML.Object` çš„åˆ—è¡¨ï¼Œæ¯”å¦‚ï¼š

```javascript
query.first().then(function(result){
  var relation = result.relation('likes');
  relation.query().find();
});
```
### è®¡æ•°å™¨
è®¡æ•°å™¨æ˜¯åº”ç”¨å¸¸è§çš„åŠŸèƒ½éœ€æ±‚ä¹‹ä¸€ã€‚å½“æŸä¸€æ•°å€¼ç±»å‹çš„å­—æ®µä¼šè¢«é¢‘ç¹æ›´æ–°ï¼Œä¸”æ¯æ¬¡æ›´æ–°æ“ä½œéƒ½æ˜¯å°†åŸæœ‰çš„å€¼å¢åŠ æŸä¸€æ•°å€¼ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©è®¡æ•°å™¨åŠŸèƒ½ï¼Œæ›´é«˜æ•ˆçš„å®Œæˆæ•°æ®æ“ä½œã€‚å¹¶ä¸”é¿å…çŸ­æ—¶é—´å†…å¤§é‡æ•°æ®ä¿®æ”¹è¯·æ±‚å¼•å‘å†²çªå’Œè¦†ç›–ã€‚

æ¯”å¦‚è®°å½•æŸç”¨æˆ·æ¸¸æˆåˆ†æ•°çš„å­—æ®µ "score"ï¼Œæˆ‘ä»¬ä¾¿ä¼šé¢‘ç¹åœ°ä¿®æ”¹ï¼Œå¹¶ä¸”å½“æœ‰å‡ ä¸ªå®¢æˆ·ç«¯åŒæ—¶è¯·æ±‚æ•°æ®ä¿®æ”¹æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æ¯æ¬¡éƒ½åœ¨å®¢æˆ·ç«¯è¯·æ±‚è·å–è¯¥æ•°æ®ï¼Œå¹¶ä¸”ä¿®æ”¹åä¿å­˜è‡³äº‘ç«¯ï¼Œä¾¿å¾ˆå®¹æ˜“é€ æˆå†²çªå’Œè¦†ç›–ã€‚

#####é€’å¢è®¡æ•°å™¨
æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨`increment()`æ–¹æ³•(é»˜è®¤å¢é‡ä¸º 1)ï¼Œé«˜æ•ˆå¹¶ä¸”æ›´å®‰å…¨åœ°æ›´æ–°è®¡æ•°å™¨ç±»å‹çš„å­—æ®µã€‚å¦‚ï¼Œä¸ºäº†æ›´æ–°è®°å½•ç”¨æˆ·æ¸¸æˆåˆ†æ•°çš„å­—æ®µ "score"ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š

```javascript
gameScore.increment('score');
gameScore.save();
```

#####æŒ‡å®šå¢é‡
```javascript
gameScore.increment('score', 3);
gameScore.save();
```

#####é€’å‡è®¡è®¡æ•°å™¨
```javascript
gameScore.increment('score', -3);
gameScore.save();
```
æ³¨æ„ï¼š
å¢é‡æ— éœ€ä¸ºæ•´æ•°ï¼Œæ‚¨è¿˜å¯ä»¥æŒ‡å®šå¢é‡ä¸ºæµ®ç‚¹ç±»å‹çš„æ•°å€¼ã€‚

### æ•°ç»„
ä¸ºäº†å¸®ä½ å­˜å‚¨æ•°ç»„ç±»æ•°æ®ï¼ŒMaxLeap æä¾›äº†ä¸‰ç§æ“ä½œè®©ä½ å¯ä»¥åŸå­åœ°æ”¹åŠ¨ä¸€ä¸ªæ•°ç»„çš„å€¼ï¼ˆå½“ç„¶ï¼Œä»–ä»¬éƒ½éœ€è¦ä¸€ä¸ªç»™å®šçš„ keyï¼‰:

* **`add`ï¼š** åœ¨ä¸€ä¸ªæ•°ç»„çš„æœ«å°¾åŠ å…¥ä¸€ä¸ªç»™å®šçš„å¯¹è±¡
* **`addUnique`ï¼š** åªä¼šæŠŠåŸæœ¬ä¸å­˜åœ¨çš„å¯¹è±¡åŠ å…¥æ•°ç»„ï¼Œæ‰€ä»¥åŠ å…¥çš„ä½ç½®æ²¡æœ‰ä¿è¯
* **`remove`ï¼š** åœ¨ä¸€ä¸ªæ•°ç»„ä¸­åˆ é™¤æ‰€æœ‰æŒ‡å®šçš„å®ä¾‹

æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³åœ¨ä¸€æ¡å¾®åšçš„å±æ€§ "tags" ä¸­åŠ å…¥å¤šä¸ªå±æ€§å€¼:

```javascript
post.addUnique('tags', 'Frontend');
post.addUnique('tags', 'JavaScript');
post.save();
```
### æ•°æ®ç±»å‹
åˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬ä½¿ç”¨äº† `String`ã€`Number` å’Œ `ML.Object` ç±»å‹ï¼ŒMaxLeap åŒæ ·æ”¯æŒ JavaScript çš„ `Date` å’Œ `null` ç±»å‹ã€‚
ä½ å¯ä»¥ç”¨ä¸€ä¸ª `ML.Object` ä¸­åµŒå¥— JavaScript å¯¹è±¡å’Œæ•°ç»„æ¥è¡¨è¿°æ›´åŠ ç»“æ„åŒ–çš„æ•°æ®:

```javascript
var number = 123, date = new Date(), array = ['a', 'b'], object = {name: 'test'};
var post = new Post();
post.set('number', number);
post.set('date', date);
post.set('array', array);
post.set('object', object);
post.save();
```

## æŸ¥è¯¢
### åŸºæœ¬æŸ¥è¯¢
ä½¿ç”¨MLQueryæŸ¥è¯¢ `ML.Object ` åˆ†ä¸‰æ­¥ï¼š

1. åˆ›å»ºä¸€ä¸ª `ML.Query ` å¯¹è±¡ï¼Œå¹¶æŒ‡å®šå¯¹åº”çš„ "`ML.Object` class"ï¼›
2. ä¸º `MLQuery` æ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼›
3. æ‰§è¡Œ `MLQuery `ï¼šä½¿ç”¨ `query.find()` æ–¹æ³•æŸ¥è¯¢ä¸æ¡ä»¶åŒ¹é…çš„ `ML.Object ` æ•°æ®ã€‚

ä¾‹å¦‚ï¼ŒæŸ¥è¯¢å­˜åœ¨ `objectId` çš„ GameScoreï¼š

```javascript
var GameScore = ML.Object.extend('GameScore');
var query = new ML.Query(GameScore);
query = new ML.Query(GameScore);
query.exists('name');
query.equalTo('score', 13);
query.find();
```
### æŸ¥è¯¢æ¡ä»¶
`equalTo` æ–¹æ³•ç”¨æ¥è¿‡æ»¤ç¬¦åˆè¦æ±‚çš„å¯¹è±¡ï¼š

```javascript
query.equalTo('pubUser', 'MaxLeap å®˜æ–¹å®¢æœ');
```

`notEqualTo` æ–¹æ³•ç”¨æ¥è¿‡æ»¤ä¸ç¬¦åˆè¦æ±‚çš„å¯¹è±¡ï¼Œ`equalTo` æ­£å¥½ç›¸åï¼š

```javascript
query.equalTo('pubUser', 'MaxLeap å®˜æ–¹å®¢æœ');
```

å¯¹äºç±»å‹ä¸ºæ•°å­—çš„å±æ€§ï¼Œæ‚¨å¯ä»¥å¯¹å…¶å€¼çš„å¤§å°è¿›è¡Œç­›é€‰ï¼š

```javascript
query.greaterThan('score', 7);
query.greaterThanOrEqualTo('score', 7);
query.lessThan('score', 11);
query.lessThanOrEqualTo('score', 11);
```
æ‚¨å¯ä»¥ä½¿ç”¨ `select` å’Œä¸€ä¸ª `keys` çš„åˆ—è¡¨æ¥é™å®šè¿”å›çš„å­—æ®µï¼Œæ¯”å¦‚åªè·å– â€œnameâ€ å’Œ â€œscoreâ€ å­—æ®µ(è‡ªåŠ¨åŒ…å«å†…å»ºå±æ€§ï¼Œ å¦‚ objectIdï¼ŒcreatedAt åŠ updatedAt)ï¼š

```javascript
query.select('name', 'score');
```
å‰©ä¸‹çš„å­—æ®µå¯ä»¥ä¹‹åç”¨è¿”å›çš„å¯¹è±¡çš„ fetch æ–¹æ³•æ¥è·å–ï¼š

```javascript
query.first().then(function(result){
  result.fetch();
});
```

å¦‚æœæƒ³è®©è¿”å›çš„å¯¹è±¡çš„æŸä¸ªå±æ€§åŒ¹é…å¤šä¸ªå€¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `containedIn`ï¼Œæä¾›ä¸€ä¸ªæ•°ç»„å°±å¯ä»¥äº†ã€‚æ¯”å¦‚æŸ¥è¯¢åå­—ä¸ºã€Œhenryï¼Œfrankã€çš„ GameScore ï¼š

```javascript
query.containedIn('name',['henry', 'zhou']);
```

ç›¸ååœ°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `notContainedIn` æ–¹æ³•æ¥æŸ¥è¯¢åœ¨é›†åˆä¹‹å¤–çš„ç›®æ ‡å¯¹è±¡ã€‚

å¦‚æœä½ åªæƒ³è¦ä¸€ä¸ªç»“æœï¼Œä¸€ä¸ªæ›´åŠ æ–¹ä¾¿çš„æ–¹æ³•å¯èƒ½æ˜¯ä½¿ç”¨ `first()`ï¼Œè€Œä¸æ˜¯ `find()` æ–¹æ³•:

```javascript
query.first()
```

ä½¿ç”¨ `skip` è·³è¿‡å‰é¢çš„ç»“æœï¼Œè¿™å¯èƒ½å¯¹åˆ†ä¸šå¾ˆæœ‰ç”¨ï¼š 

```javascript
query.skip(10); // è·³è¿‡å‰ 10 æ¡ç»“æœ
```

ä½ å¯ä»¥ç”¨è®¾å®š limit çš„æ–¹æ³•æ¥é™å®šè¿”å›çš„ç»“æœæ•°ï¼Œé»˜è®¤çš„è¿”å›ç»“æœæ•°æ˜¯ 100ï¼Œä½†æ˜¯ä»» ä½• 1 åˆ° 1000 ä¹‹é—´çš„æ•°å€¼éƒ½æ˜¯åˆæ³•çš„ï¼Œåœ¨ 0 åˆ° 1000 èŒƒå›´ä¹‹å¤–çš„éƒ½å¼ºåˆ¶è½¬æˆé»˜è®¤çš„ 100ã€‚

```javascript
query.limit(10); // æœ€å¤šè¿”å› 10 æ¡ç»“æœ
```

å¯¹äºå¯ä»¥æ’åºçš„ç±»å‹ï¼Œæ¯”å¦‚ `number` å’Œ `string`ï¼Œä½ å¯ä»¥æ§åˆ¶è¿”å›ç»“æœçš„é¡ºåºï¼š

```javascript
query.ascending('pubUser'); // å‡åº

query.descending('pubTimestamp'); // é™åº
```
### å¯¹æ•°ç»„å€¼åšæŸ¥è¯¢
å¯¹äºå±æ€§å€¼æ˜¯æ•°ç»„çš„æƒ…å†µï¼Œæ‚¨å¯ä»¥è¿™æ ·æŸ¥è¯¢æ•°ç»„çš„å€¼ä¸­æœ‰ â€œhenryâ€ çš„æ¸¸æˆè®°å½•ï¼š

```javascript
query.equalTo('developer', 'henry');
```
æ‚¨åŒæ ·å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼æ‰¾åˆ°å±æ€§å€¼ä¸­åŒæ—¶åŒ…å« â€œhenryâ€ï¼Œâ€œfrankâ€ çš„æ¸¸æˆè®°å½•ï¼š

```javascript
query.containsAll('developer', ['henry', 'frank']);
```
æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æ ¹æ®æ•°ç»„é•¿åº¦æ¥æŸ¥è¯¢ï¼Œæ¯”å¦‚æŸ¥è¯¢ developer äººæ•°ä¸º 2 çš„æ¸¸æˆè®°å½•ï¼š

```javascript
query.sizeEqualTo('developer', 2);
```

### å¯¹å­—ç¬¦ä¸²ç±»å‹åšæŸ¥è¯¢
ä½¿ç”¨ `startsWith()` æ¥é™åˆ¶å±æ€§å€¼ä»¥ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²å¼€å¤´ï¼Œæ¯”å¦‚æ‰¾å‡º name ä»¥ â€œbaiâ€ å¼€å¤´çš„æ¸¸æˆè®°å½•ï¼š

```javascript
query.startsWith('name', 'bai');
```

### å…³ç³»æŸ¥è¯¢
å¯¹äºæŸ¥è¯¢å…³ç³»å‹æ•°æ®æ¥è¯´æœ‰å‡ ç§ä¸åŒçš„æ–¹å¼ï¼Œå¦‚æœæ‚¨æƒ³è¦è·å–çš„å¯¹è±¡ä¸­æœ‰æŸä¸ªå±æ€§åŒ…å«ä¸€ä¸ªç‰¹å®šçš„ `ML.Object`ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `equalTo()`ï¼Œå°±åƒå¯¹äºåˆ«çš„æ•°æ®ç±»å‹ä¸€æ ·ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ¯æ¡ Comment çš„ post å­—æ®µéƒ½æœ‰ä¸€ä¸ª Post å¯¹è±¡ï¼Œé‚£ä¹ˆæ‰¾å‡ºæŒ‡å®š post ä¸‹çš„ commentï¼š

```javascript
// å‡è®¾ myPost æ˜¯å·²ç»åˆ›å»ºçš„å¯¹è±¡ã€‚
var query = new ML.Query(Comment);
query.equalTo('post', myPost);
query.find();
```
å¦‚æœæƒ³å¾—åˆ°å…¶å­—æ®µä¸­åŒ…å«çš„å­å¯¹è±¡æ»¡è¶³å¦ä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœï¼Œä½ å¯ä»¥ä½¿ç”¨ `matchesQuery()` æ“ä½œã€‚ æ³¨æ„é»˜è®¤çš„ç»“æœæ¡æ•°é™åˆ¶ 100 å’Œæœ€å¤§å€¼ 1000 ä¹ŸåŒæ ·é€‚ç”¨äºå­æŸ¥è¯¢ï¼Œæ‰€ä»¥å¯¹äºå¤§çš„æ•°æ®é›†æ‚¨å¯èƒ½éœ€è¦å°å¿ƒæ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼Œå¦åˆ™å¯èƒ½å‡ºç°æ„æ–™ä¹‹å¤–çš„çŠ¶ å†µã€‚ä¾‹å¦‚ï¼Œä¸ºäº†æ‰¾åˆ°æœ‰å›¾ç‰‡çš„ post çš„ commentï¼Œæ‚¨å¯ä»¥ï¼š

```javascript
var innerQuery = new AV.Query(Post);
innerQuery.exists('image');
var query = new AV.Query(Comment);
query.matchesQuery('post', innerQuery);
query.find().then(function(comments) {
    // comments åŒ…å«æœ‰æ‰€æœ‰å¸¦å›¾ç‰‡ post çš„ comment.
  });
```
å¦‚æœæ‚¨æƒ³è¦è·å–æŸå­—æ®µä¸­åŒ…å«çš„å­å¯¹è±¡ä¸æ»¡è¶³æŒ‡å®šæŸ¥è¯¢çš„ç»“æœï¼Œä½ å¯ä»¥ä½¿ç”¨ `doesNotMatchQuery()`ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†æ‰¾åˆ°é’ˆå¯¹ä¸å«å›¾ç‰‡çš„ post çš„ commentï¼Œå¯ä»¥è¿™æ ·ï¼š

```javascript
var innerQuery = new AV.Query(Post);
innerQuery.exists('image');
var query = new AV.Query(Comment);
query.doesNotMatchQuery('post', innerQuery);
query.find().then(function(comments) {
    // comments åŒ…å«æ‰€æœ‰ä¸å¸¦å›¾ç‰‡ post çš„ comment.
  })
```


## UserPrincipal
SDKæä¾›ä½¿ç”¨ç”¨æˆ·è¯·æ±‚åŸå§‹ä¿¡æ¯UserPrincipalæ¥è®¿é—®æ•°æ®ï¼Œè€Œä¸æ˜¯é€šè¿‡cloudcodeçš„masterKeyæ¥å®ç°ï¼Œè¿™æ ·æ•°æ®åœ¨è®¿é—®æµé€šè¿‡ç¨‹ä¸­å¯ä»¥æœ‰æ•ˆä¿è¯keyçš„å®‰å…¨æ€§ï¼Œè€Œä¸è¢«äººæ‹¦æˆªè¯·æ±‚æˆªè·masterKeyä¿¡æ¯ã€‚

###ä½¿ç”¨UserPrincipal
SDKåœ¨å¤„ç†hookè¯·æ±‚æ—¶ä¼šé»˜è®¤ä½¿ç”¨UserPrincipalï¼Œåœ¨function/jobä¸­ä½ å¯ä»¥é€šè¿‡è·å–Requestå¯¹è±¡çš„UserPrincipalæ¥å®Œæˆä½ çš„æ•°æ®è®¿é—®ã€‚

```javascript
ML.Cloud.function('hello',function(req, res){
	var Comment = ML.Object.extend('Comment');
	var comment = new Comment();
	comment.UseUserPrincipal(req);
	comment.set('title','hello');
	comment.save().then(function(result){
		res.end(result.id);
	});
});
```
* å¦‚æœä½ ä¸ä½¿ç”¨UserPrincipalæ¥è®¿é—®æ•°æ®ï¼ŒSDKä¼šé»˜è®¤ä½¿ç”¨master-keyï¼ˆå³é…ç½®æ–‡ä»¶global.jsonä¸­çš„applicationKeyï¼‰æ¥è®¿é—®æ•°æ®
* æ‰€æœ‰SDKçš„apiéƒ½æä¾›äº†ä½¿ç”¨UserPrincipalæ–¹å¼æ¥è®¿é—®æ•°æ®ï¼Œé™¤äº†cloudcodeäº‘ä»£ç è‡ªèº«å‘èµ·çš„è¯·æ±‚å¿…é¡»ä½¿ç”¨masterKeyæ¥è®¿é—®å¤–ï¼Œå…¶ä»–æ‰€æœ‰è¯·æ±‚æˆ‘ä»¬å»ºè®®ä½ ä½¿ç”¨UserPrincipalè¿™ç§æ–¹å¼æ¥ä¿è¯ä½ çš„ç§˜é’¥å®‰å…¨ã€‚


## äº‘ä»£ç  é¡¹ç›®

### æ–°å»ºä¸€ä¸ªé¡¹ç›®

### ä¸€ä¸ªNodejs CloudCodeé¡¹ç›®çš„ç›®å½•æ ‘åº”è¯¥å¦‚ä¸‹ï¼š

```
â”œâ”€â”€ app                     #cloudcodeä¸»ç›®å½• (å¿…å¤‡)
â”‚   â”œâ”€â”€ package.json        #cloudcodeçš„ç¯å¢ƒä¾èµ–ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ function            #functionç›®å½•ï¼ˆå¯é€‰ï¼‰
â”‚   â”‚   â””â”€â”€ demo.py
â”‚   â”œâ”€â”€ hook                #hookç›®å½•ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ job                 #jobç›®å½•ï¼ˆå¯é€‰ï¼‰
|   â””â”€â”€ tests               #testsç›®å½•ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ config                  #cloudcodeé…ç½®æ–‡ä»¶ç›®å½•ï¼ˆå¿…å¤‡ï¼‰
â”‚   â””â”€â”€ global.json         #cloudcodeé…ç½®æ–‡ä»¶ï¼ˆå¿…å¤‡ï¼‰
â””â”€â”€ node_modules            #cloudcodeçš„ç¯å¢ƒä¾èµ–ï¼ˆå¯é€‰ï¼‰
```

æ¸©é¦¨æç¤º: å¦‚æœä½ éœ€è¦æ‰‹åŠ¨ zip æ‰“åŒ…é¡¹ç›®,è¯·ä¿æŒç›®å½•ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤º,è¯·å‹¿å†å¤–å¥—ä¸€å±‚ç›®å½•.

### ç›®å½•åŠ è½½é¡ºåº

1. npmå®‰è£…package.json
2. æ‹·è´node_modulesä¾èµ– (åŒ…æ‹¬ mlcloudcode)
3. åŠ è½½ç¨‹åºæ–‡ä»¶ï¼Œé¡ºåºä¸ºï¼šconfig -> hook -> job -> function

### ä¿®æ”¹é…ç½®
åœ¨/configï¼ˆè¯·ç¡®ä¿æ­¤è·¯å¾„å­˜åœ¨ï¼‰ä¸­ï¼Œæ·»åŠ global.jsonæ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š

```python
{
	"applicationName" : "HelloWorld",
	"applicationId": "YOUR_APPLICATION_ID",
	"applicationKey": "YOUR_MASTER_KEY",
	"lang" : "nodejs",
	"version": "0.0.1"
}
```

æ ¹æ®åˆ›å»ºåº”ç”¨æ—¶è·å–çš„keyï¼Œä¿®æ”¹ä¸‹åˆ—é”®çš„å€¼ï¼š

é”®|å€¼|
------------|-------|
applicationName|MaxLeapåº”ç”¨åç§°
applicationId|Application ID
applicationKey|Master Key
version|å½“å‰äº‘ä»£ç é¡¹ç›®ç‰ˆæœ¬å·


##### *cloudcode çš„è¿è¡Œç¯å¢ƒå†…ç½®æœ€æ–°ç‰ˆæœ¬çš„mlcloudcode*

### ä½¿ç”¨sdk

- å®šä¹‰ä½ çš„ç¬¬ä¸€ä¸ªfunction

  åœ¨æ–‡ä»¶function/demo.pyä¸­

  ```javascript
  var ML = require('mlcloudcode');
  ML.Cloud.function("helloword", function(req, res){
  		res.end("helloword");
  }
  ```

  ä½¿ç”¨Cloud.functionæ¥å®šä¹‰ä½ çš„functionã€‚æ¯ä¸ªfunctionéƒ½è°ƒç”¨res.endè¿”å›ä¸€ä¸ªResponseã€‚

- å®šä¹‰ä½ çš„ç¬¬ä¸€ä¸ªjob

  åœ¨æ–‡ä»¶job/demo.pyä¸­

  ```javascript
  var ML = require('mlcloudcode');
  ML.Cloud.job("helloword", function(req, res){
  		res.end("helloword");
  }
  ```

  ä½¿ç”¨Cloud.jobæ¥å®šä¹‰ä½ çš„jobã€‚æ¯ä¸ªjobéƒ½è°ƒç”¨res.endè¿”å›ä¸€ä¸ªResponseã€‚

### å®ç°å¤æ‚ç‚¹çš„Fuction

è¿™é‡Œæˆ‘ä»¬ç®€å•å®ç°ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼Œæäº¤ä¸€ä¸ªå¿è€…åç§°ï¼Œç”Ÿæˆä¸€ä¸ªå¿è€…æœ¬ä½“å’Œå®ƒçš„50ä¸ªå½±åˆ†èº«ï¼Œæ‰¾å‡ºå…¶ä¸­ç¬¬50ä¸ªåˆ†èº«ï¼Œå‡»æ€å…¶ä½™åˆ†èº«å’Œæœ¬ä½“ï¼Œè®©å®ƒæˆä¸ºæ–°çš„æœ¬ä½“

```javascript
var ML = require('mlcloudcode');
ML.serverURL = "http://apidev.leap.as";

var Ninja = ML.Object.extend('Ninja');

ML.Cloud.function("helloNinja", function(req, res){
    // è·å–name
    var name = req.body.name;
    var promise = ML.Promise.as();
    var ninja = null;
    var ninja_50 = null;

    // äº§ç”Ÿæœ¬ä½“
    promise = promise.then(function(){
        ninja = new Ninja();
        ninja.set('name', name);
        return ninja.save().then(function(ninja){
            ML.Log.info("ç”Ÿæˆæœ¬ä½“ï¼ŒIDä¸ºï¼š"+ninja.id);
        })
    });

    // äº§ç”Ÿ50ä¸ªåˆ†èº«
    var clone_ninja_ids = [];
    for(var i = 0; i < 50; i++){
        promise = promise.then(function(){
            var idx = i;
            return function(){
                var clone_ninja = new Ninja();
                clone_ninja.set('name', name + '_' + idx);
                return clone_ninja.save().then(function(clone_ninja){
                    ML.Log.info("å¤šé‡éšåˆ†èº«ï¼š"+clone_ninja.id);
                    clone_ninja_ids.push(clone_ninja.id);
                });
            }
        }());
    }

    // æ‰¾å‡ºç¬¬50ä¸ªåˆ†èº«
    promise = promise.then(function(){
        var query = new ML.Query(Ninja);
        query.equalTo('name',name + '_49');
        return query.first().then(function(result){
            ML.Log.info("æ‰¾åˆ°ç¬¬50ä¸ªåˆ†èº«:"+result.id);
            clone_ninja_ids = ML._.without(clone_ninja_ids, result.id);
            ninja_50 = result;
        });
    });

    // å‡»æ€å…¶ä½™49ä¸ªåˆ†èº«
    promise = promise.then(function(){
        var query = new ML.Query(Ninja);
        query.containedIn('objectId',clone_ninja_ids);
        return query.find().then(function(results){
            var del_promise = ML.Promise.as();
            ML._.each(results, function(result){
                del_promise = del_promise.then(function(){
                    return result.destroy().then(function(){
                        ML.Log.info("å‡»æ€åˆ†èº«:"+result.id);
                    });
                });
            });
            del_promise = del_promise.then(function(){
                ML.Log.info("å®Œæˆåˆ†èº«å‡»æ€æ•°ç›®:"+results.length);
            });
            return del_promise;
        });
    });

    // å‡»æ€æœ¬ä½“
    promise = promise.then(function(){
        return ninja.destroy().then(function(){
            ML.Log.info("å®Œæˆæœ¬ä½“å‡»æ€");
        })
    })

    // è®©ç¬¬50ä¸ªåˆ†èº«æˆä¸ºæ–°çš„æœ¬ä½“
    promise = promise.then(function(){
        ninja_50.set('name',name + '_new');
        return ninja_50.save().then(function(result){
            ML.Log.info("ç¬¬50ä¸ªåˆ†èº«åœ¨"+ninja_50.updatedAt.toISOString()+"æˆä¸ºæ–°çš„æœ¬ä½“");
        });
    });

    // è¿”å›æ–°çš„æœ¬ä½“åç§°
    promise.then(function(){
        res.end(ninja_50.get('name'));
    }).catch(function(err){
        res.end(JSON.stringify(err));
    });

});

```

### å®ç°HOOKæ“ä½œ
æ”¯æŒbefore_saveã€after_saveã€after_updateã€before_deleteã€after_delete
æ ·ä¾‹å¦‚ä¸‹ï¼š

```javascript
var ML = require('mlcloudcode');

//æµ‹è¯•hook
ML.Cloud.beforeSave('Ninja', function(obj, res){
    ML.Log.info("beforeSave:" + JSON.stringify(obj));
    res.success();
});

ML.Cloud.afterSave('Ninja', function(obj, res){
    ML.Log.info("afterSave:" + JSON.stringify(obj));
    res.success();
});

ML.Cloud.afterUpdate('Ninja', function(obj, res){
    ML.Log.info("afterUpdate:" + JSON.stringify(obj));
    res.success();
});

ML.Cloud.beforeDelete('Ninja', function(obj, res){
    ML.Log.info("beforeDelete:" + JSON.stringify(obj));
    res.success();
});

ML.Cloud.afterDelete('Ninja', function(obj, res){
    ML.Log.info("afterDelete:" + JSON.stringify(obj));
    res.success();
});
```

æ‰€æœ‰çš„hookæ–¹æ³•æ¥æ”¶å‚æ•°ä¸ºè¡¨å

hookçš„æ‰§è¡Œé¡ºåºä¸ºï¼šbefore hook -> original behavior -> after hook

hookæ–¹æ³•å¯ä»¥é€‰æ‹©è°ƒç”¨res.success()æˆ–è€…res.error({"msg":"error"})ï¼Œå¦‚æœhooké‡Œé¢è°ƒç”¨äº†res.error({"msg":"error"})ï¼Œåœ¨è¿™ä¸ªhookä¹‹åçš„æ“ä½œéƒ½ä¸ä¼šæ‰§è¡Œï¼Œæ–¹æ³•res.errorçš„å‚æ•°å°†ç›´æ¥è¿”å›ç»™è¯·æ±‚è€…ã€‚

## æ—¥å¿—
### ä½¿ç”¨æ—¥å¿—

*Logå®ä¾‹ç”¨æ¥è®°å½•æ—¥å¿—*

```javascript
ML.Log.info("test log");
```

* ç›®å‰æœ‰logï¼Œwarnï¼Œerrorï¼Œdebugå››ä¸ªçº§åˆ«*

* æœ¬åœ°æµ‹è¯•ä¸ä¼šäº§ç”Ÿæ•°æ®åº“è®°å½•ï¼Œä½†å‘å¸ƒåä¼šäº§ç”Ÿè®°å½•ï¼Œä½ å¯ä»¥åœ¨åç«¯ç•Œé¢æŸ¥çœ‹ä½ çš„æ—¥å¿—ä¿¡æ¯*

* å¦‚æœä½ çš„functionè°ƒç”¨é¢‘ç‡å¾ˆé«˜è¯·åœ¨å‘å¸ƒå‰å°½é‡å»æ‰è°ƒè¯•æµ‹è¯•æ—¥å¿—ä»¥ä¾¿ä¸å¿…è¦çš„æ—¥å¿—å­˜å‚¨*

### æŸ¥çœ‹æ—¥å¿—
å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·MaxLeap-CLIæŸ¥çœ‹æœ€è¿‘çš„log

```shell
maxleap log -n 100
```
ä¹Ÿè¿›å…¥â€œç®¡ç†ç½‘ç«™â€ï¼Œç‚¹å‡»â€œå¼€å‘è€…ä¸­å¿ƒâ€ï¼>â€œæ—¥å¿—â€ï¼Œæ‚¨ä¾¿å¯æŸ¥çœ‹è¯¥åº”ç”¨çš„æ‰€æœ‰æ—¥å¿—ã€‚

## æœ¬åœ°å•å…ƒæµ‹è¯•

`ML.Cloud`å®ä¾‹æä¾›äº†`callFunction` å’Œ`callJob` æ¥æµ‹è¯•ä½ çš„ç¨‹åºã€‚

ä½¿ç”¨`mocha`æ¥æµ‹è¯•ä½ çš„ä»£ç ï¼š

`mocha tests/test_ninja.js`

```javascript
'use strict';
var ML = require('mlcloudcode');
var expect = require('expect.js'),
    should = require('should'),
    fs = require('fs'),
    request = require('supertest'),
    assert = require('assert');

require('../function/ninja.js');

var appId = '56273907169e7d0001bd5c92';
var appkey = 'TXV4MFB2SFFQdVpPSjJKYnFtSVdlUQ';
ML.initialize(appId, appkey);
ML.useCNServer();

describe('function', function(){
    it('helloNinja',function(done){
      ML.Cloud.callFuction('helloNinja',{'name':'test'},function(res){
         assert(res.body, 'test_new');
      }, done);
  });
});

```

*åœ¨æµ‹è¯•ç”¨ä¾‹é‡Œé¢ä½ éœ€è¦æŠŠä½ æ‰€æœ‰çš„functionã€jobã€hookæ–‡ä»¶å…¨éƒ¨requireè¿›æ¥*

## MLC ï¼ äº‘ä»£ç å‘½ä»¤è¡Œå·¥å…·
MLCå‘½ä»¤è¡Œå·¥å…·æ˜¯ä¸ºäº‘ä»£ç é¡¹ç›®çš„ä¸Šä¼ ï¼Œéƒ¨ç½²ï¼Œåœæ­¢åŠç‰ˆæœ¬ç®¡ç†è€Œè®¾è®¡çš„ã€‚æ‚¨å¯ä»¥åˆ©ç”¨å®ƒï¼Œå°†Mavené¡¹ç›®ç”Ÿæˆçš„packageä¸Šä¼ åˆ°MaxLeapï¼Œåœ¨äº‘ç«¯ï¼Œpackageå°†è¢«åˆ¶ä½œæˆDocker Imageï¼Œè€Œéƒ¨ç½²è¿‡ç¨‹ï¼Œå°±æ˜¯åˆ©ç”¨Docker Containerå°†è¿™ä¸ªImageå¯åŠ¨ã€‚è€Œè¢«ä¸Šä¼ åˆ°äº‘ç«¯çš„æ¯ä¸ªç‰ˆæœ¬çš„äº‘ä»£ç éƒ½å°†è¢«ä¿å­˜ï¼Œæ‚¨å¯ä»¥è‡ªç”±åœ°å¸è½½æŸä¸€ä¸ªç‰ˆæœ¬ï¼Œè€Œåéƒ¨ç½²å¦å¤–ä¸€ä¸ªç‰ˆæœ¬çš„äº‘ä»£ç .
###ç™»å½•:
```shell
maxleap æˆ–è€…maxleap -username <ç”¨æˆ·é‚®ç®±> -region <CN or US ...>
```
`<ç”¨æˆ·é‚®ç®±>` ä¸ºæ‚¨ç™»å½•MaxLeapç®¡ç†ä¸­å¿ƒçš„è´¦å·é‚®ç®±ï¼Œ`<CN or US ...>` ä¸ºé€‰æ‹©ä¸­å›½åŒºè´¦å·è¿˜æ˜¯ç¾å›½åŒºè´¦å·ï¼Œç„¶åæ ¹æ®æç¤ºè¾“å…¥å¯†ç 
###æ˜¾ç¤ºæ‰€æœ‰appï¼š
```shell
apps
```
æŸ¥è¯¢è´¦å·ä¸‹çš„æ‰€æœ‰åº”ç”¨ï¼Œæ˜¾ç¤ºçš„ä¿¡æ¯ä¸ºï¼šAppId ï¼šAppName
###é€‰æ‹©åº”ç”¨:
```shell
use <åº”ç”¨å>
```
`<åº”ç”¨å>`ä¸ºç›®æ ‡åº”ç”¨åï¼Œå¦‚æœåº”ç”¨ååŒ…å«ç©ºæ ¼ï¼Œä½ å¯ä»¥ç”¨`use "åº”ç”¨å"`å³ä½¿ç”¨å¼•å·æ¥åˆ‡æ¢åº”ç”¨ã€‚é€‰æ‹©ä¹‹åï¼Œæ¥ä¸‹æ¥çš„æ“ä½œï¼ˆä¸Šä¼ /éƒ¨ç½²/åœæ­¢/ç‰ˆæœ¬ç®¡ç†ï¼‰éƒ½å°†ä»¥æ­¤åº”ç”¨ä¸ºä¸Šä¸‹æ–‡ã€‚
###ä¸Šä¼ äº‘ä»£ç :
```shell
upload <æ–‡ä»¶è·¯å¾„>
```
`<æ–‡ä»¶è·¯å¾„>`ä¸ºä½ å°†éƒ¨ç½²çš„äº‘ä»£ç  packageï¼ˆzipæ–‡ä»¶ï¼‰ï¼Œå®ƒå°†è¢«ä¸Šä¼ åˆ°æ­¥éª¤3æŒ‡å®šçš„åº”ç”¨ä¸‹ã€‚
ä¸Šä¼ çš„çš„ä»£ç ä¼šè¢«åˆ¶ä½œæˆDockeré•œåƒï¼Œç‰ˆæœ¬å·åœ¨äº‘ä»£ç é¡¹ç›®é‡Œçš„global.jsonæ–‡ä»¶ä¸­æŒ‡å®šï¼š
```
"version": "0.0.1"
```
###æ˜¾ç¤ºæ‰€æœ‰äº‘ç«¯äº‘ä»£ç ç‰ˆæœ¬:
```shell
lv
```
å³æ˜¾ç¤ºæ‰€æœ‰è¯¥åº”ç”¨ä¸‹ï¼Œç”¨æˆ·ä¸Šä¼ è¿‡çš„äº‘ä»£ç çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚
###éƒ¨ç½²äº‘ä»£ç ï¼š
```shell
deploy <ç‰ˆæœ¬å·>
```
`<ç‰ˆæœ¬å·>`ä¸ºæƒ³è¦éƒ¨ç½²çš„äº‘ä»£ç ç‰ˆæœ¬å·ï¼šå¦‚æ‰§è¡Œdeploy 0.0.1ï¼Œå°†éƒ¨ç½²æŒ‡å®šåº”ç”¨ä¸‹ç‰ˆæœ¬å·ä¸º0.0.1çš„äº‘ä»£ç ã€‚å¦‚æœéƒ¨ç½²ä¸å­˜åœ¨çš„ç‰ˆæœ¬ï¼Œä¼šæç¤ºé”™è¯¯ï¼š"version of appId not exists"
###åœæ­¢cloudcodeï¼š
```shell
undeploy <ç‰ˆæœ¬å·>
```
åœæ­¢è¯¥åº”ç”¨çš„æŒ‡å®šç‰ˆæœ¬äº‘ä»£ç ï¼šå¦‚æœä¹‹å‰å·²ç»éƒ¨ç½²è¿‡ä¸€ä¸ªç‰ˆæœ¬ï¼Œéœ€è¦å…ˆåœæ­¢ï¼Œå†éƒ¨ç½²æ–°çš„ç‰ˆæœ¬ã€‚
###è¾“å‡ºæœ€è¿‘çš„æ—¥å¿—ï¼š
```shell
log [-l <info|error>] [-n <number of log>] [-s <number of skipped log>]

-l æŒ‡å®šè¾“å‡ºæ—¥å¿—çš„çº§åˆ«ï¼šinfoæˆ–æ˜¯error
-n æŒ‡å®šlogçš„æ•°é‡
-s æŒ‡å®šè·³è¿‡æœ€è¿‘çš„logæ•°é‡
```
